<div class="container py-5">
  <div *ngIf="isLoading" class="d-flex justify-content-center my-5">
    <div class="spinner-border text-danger" role="status" style="width: 4rem; height: 4rem;">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div *ngIf="errors" class="alert alert-danger text-center fs-5" role="alert">
    {{ errors }}
  </div>

  <div *ngIf="!isLoading && peticiones.length > 0" class="list-group">
    <div *ngFor="let peticion of peticiones" 
         class="list-group-item list-group-item-action mb-4 rounded shadow-sm p-4"
         style="transition: transform 0.15s ease-in-out, box-shadow 0.3s ease;">
      <div class="row g-3 align-items-center">

        <div class="col-md-4" *ngIf="peticion.file && peticion.file.file_path">
          <img [src]="'http://127.0.0.1:8000/storage/' + peticion.file.file_path" 
               alt="Imagen de la peticiÃ³n" 
               class="img-fluid rounded shadow-sm" 
               style="max-height: 180px; object-fit: cover; width: 100%;">
        </div>

        <div [class.col-md-8]="peticion.file && peticion.file.file_path" [class.col-md-12]="!peticion.file || !peticion.file.file_path">
          <h4 class="fw-bold text-danger mb-3">{{ peticion.titulo }}</h4>
          <p class="mb-3 text-secondary">{{ peticion.descripcion }}</p>
          <div class="d-flex flex-wrap gap-3 mb-3 text-muted small fst-italic">
            <span><i class="bi bi-pencil-square me-1"></i>Firmas: <strong>{{ peticion.firmantes }}</strong></span>
            <span><i class="bi bi-person me-1"></i>Usuario: <strong>{{ peticion.user_id }}</strong></span>
            <span><i class="bi bi-hash me-1"></i>ID: <strong>{{ peticion.id }}</strong></span>
          </div>

          <div class="d-flex flex-wrap gap-2">
            <a [routerLink]="['/peticiones/', peticion.id]" class="btn btn-danger btn-sm fw-semibold shadow-sm">
              + Info
            </a>

            <ng-container *ngIf="isSignedIn">
              <button class="btn btn-primary btn-sm fw-semibold shadow-sm" (click)="onFirmarPeticion(peticion.id)">
                <i class="bi bi-feather me-1"></i>Firmar
              </button>

              <ng-container *ngIf="isOwner(peticion.user_id) || user.role_id === 1">
                <button class="btn btn-danger btn-sm fw-semibold shadow-sm" (click)="onDelete(peticion.id)">
                  <i class="bi bi-trash me-1"></i>Eliminar
                </button>
                <a [routerLink]="['/petition/edit', peticion.id]" class="btn btn-success btn-sm fw-semibold shadow-sm">
                  <i class="bi bi-pencil-square me-1"></i>Editar
                </a>
              </ng-container>

              <ng-container *ngIf="user.role_id === 1">
                <button class="btn btn-warning btn-sm fw-semibold shadow-sm" (click)="onEstado(peticion.id)">
                  <i class="bi bi-sliders me-1"></i>Cambiar Estado
                </button>
              </ng-container>
            </ng-container>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div *ngIf="!isLoading && peticiones.length === 0" class="text-center text-muted fs-5 mt-5 fst-italic">
    No hay peticiones para mostrar.
  </div>
</div>
